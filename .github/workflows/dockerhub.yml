name: Push Images to Docker Hub

on:
  push:
    branches: [ master ]
  release:
    types: [ published ]

env: 
  DOCKER_USER: ${{ secrets.DOCKER_USER }}
  DOCKER_PASS: ${{ secrets.DOCKER_PASS }}
  DOCKER_TAG: ${{ github.event.release.tag_name }}
jobs:

  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    
    - name: Log into Docker Hub
      run: docker login --username $DOCKER_USER --password $DOCKER_PASS
      
    - name: Build the Docker image
      run: docker build . --tag ideasonpurpose/docker-build
    
    - name: Deploy $LATEST to Docker Hub
      run: docker push ideasonpurpose/docker-build
      
    - name: Tag image with release version
      if: github.event == 'release'
      run: docker tag ideasonpurpose/docker-build ideasonpurpose/docker-build:$DOCKER_TAG
      
    - name: Deploy tag ${{ env.DOCKER_TAG }} to Docker Hub
      if: github.event == 'release'
      run: docker push ideasonpurpose/docker-build:$DOCKER_TAG
